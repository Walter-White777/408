# 中央处理器

## CPU基本结构和功能

**组成：**

1.对用户可见的寄存器：通用寄存器组、程序状态字寄存器（PSW）、PC、基址寄存器。其它**基本**都不可见

2.指令译码器**仅对op字段**进行译码

3.MAR的宽度：决定了主存**地址空间**（并不是实际主存容量）；与地址线位数相同

4.MDR的宽度：与数据线位数相同，与存储字长相同

5.ALU的宽度：与机器字长相同

**功能：**执行指令，处理异常和中断



## 指令执行过程

**前置：**

指令周期：取出并执行指令的时间。包含多个机器周期

机器周期：一个阶段（if/id/ex/mem/wb）所用的时间，包含多个时钟周期;各个机器周期包含的时钟周期数可以不同

时钟周期：CPU操作的基本单位，aka节拍





1.单指令周期：一条指令只能在固定的时钟周期内完成，且上一条指令执行完之后，才能执行下一条

**单周期机器**指在一个时钟周期内完成指令；**多周期CPU**将一条指令分成不同阶段，不同阶段占用一个时钟周期。所以CPI>1

2.多指令&流水线：前者指多条指令串行；后者指多条指令并行

3.指令周期：指执行完一条指令的时间；包含若干（不固定）机器周期，机器周期又包含若干（固定）时钟周期

- 取指周期：取出指令保存在IR中
- 间址周期：将指令字中的地址码字段送至主存从而取出有效地址并存放在MAR
- 执行周期：**取数**并进行操作产生结果
- 中断周期：处理中断请求.特别注意中断周期将断点进栈操作是栈顶指针-1,是因为计算机的堆栈是向低地址增加

4.响应中断在指令执行结束之后，在结束前需要发中断查询信号



## 结构划分：

### 数据通路

1.数据通路：数据流经的路径（包括每一个部件，中断处理相关也算）or 由操作元件（MUX，ADDER，ALU，Decoder）和存储元件（寄存器、寄存器组）通过总线或分散方式连接而成的进行数据存储、处理和传送的路径

2.基本结构：

**1）单总线**：所有寄存器的输入和输出连接到同一条通路，**1个时钟**只允许传**一个数据**

​						单总线结构，每个部件的输入端有多路选择器，输入信号用于控制；输出端一般有一个三态门，输出信号为1时，进行输出，为0时，三态门输出端呈高阻态，与总线断开

​						**注意：区别单总线结构和单周期CPU机器，单周期CPU绝对不能用单总线结构**

**2）多总线**

**3）专用数据通路**：避免使用共享总线，硬件开销大

3.ALU的一个输入端设置暂存器的原因：ALU的两个输入端必须同时有效，T暂存器



### 控制器

**组成：**

PC、IR、指令译码器、MAR、MDR、时序系统和微操作信号发生器

#### 1.硬布线控制器

aka 组合逻辑控制器





**控制方式:**

- 同步:统一时钟信号要按照最长和最繁琐的微操作为标准.但运行速度慢
- 异步:各部件按照其各自的速度运行,通过应答方式进行联络
- 联合:对微操作**大部分**采用同步,**小部分**采用异步



#### 2.微程序控制器

机器指令-》微程序（由若干**微指令**组成，微操作指令由若干**微操作命令**组成），存储在**控制存储器**（在CPU内部，with ROM）中

机器指令可以分为一个微操作序列.微操作由微命令控制,微指令是若干微命令的集合

**注：若指令系统中由n种机器指令，则至少有n+1种微程序，因为必须有取指微程序**

**组成:**

- 控制存储器:存放微程序
- 微指令寄存器:存放当前微指令
- 微地址形成部件:产生初始微地址和后继微地址
- 微地址寄存器:接收微地址形成部件送来的微地址



**工作过程:**

- 自动将**取指微程序**的入口地址(一般是CM的0号)送入微地址寄存器,取出对应微指令,并执行后.第一条指令就进入IR
- IR的op字段通过微地址形成部件产生其对应微程序的入口地址,送入微地址寄存器
- 逐条取出微指令并执行
- 完成一个微程序后,又回到取指微程序的入口地址,取下一条指令



**地址形成方式**：

- 微指令**下地址字段**给出下一条微指令的地址（**断定方式**）
- 根据**机器指令**的操作码，通过微地址形成部件形成



**编码方式**（针对微指令的控制字段）：

- 直接编码：不用译码,每一位代表一个微命令（即n种微命令需要n位）

- **字段直接编码**：控制字段分成不同组，**互斥**的微操作命令放在**同一**组，**相容**的放在**不同**组内。每个组内一般留出000（全0）表示不操作

- 字段间接编码:一个组内的微命令由另一个组内的微命令来解释

**微指令格式**：

- 水平型：定义并执行几种**并行的基本操作**.操作控制字段+顺序控制

- 垂直型：定义并执行**一种**基本操作



## 指令流水线

### 1.冒险

**1）数据冒险：**



**2）控制冒险**



**3）结构冒险**



### 2.流水线数据通路

数据通路由控制部件控制，但不包括控制部件



### 3.高级流水线技术

- 超标量流水线：每个时钟周期内并发多条指令。通过编译优化技术（动态调度技术），将可以并行的指令放在一起.CPI<1

- 超长指令字技术：将能并行的指令组合成一条超长指令

- 超流水线技术：流水线主频更高，即更快地发射指令，但最终CPI=1



## 多处理器：

- **SISD：**一个处理器一个存储器，一段时间只执行一条指令
- **SIMD：**一个控制部件，多个处理单元；一个指令流对多个数据流进行处理，适合循环操作
- MISD：
- **MIMD：**同时多条指令流，多个数据流
- 向量处理器：SIMD的变体，直接操作一维数组指令集的CPU 
- SMP:共享存储多处理器，具有共享的单一物理地址空间，通过存取指令访问存储器
- 硬件多线程
- 多核处理器：属于MIMD