# OS概述



## OS分类

### **1.单道批处理：**

一次一个作业，依次执行，交互性



### **2.多道批处理：**

多道程序设计技术（宏观上并行，微观上并发）

无交互



### **3.分时**



### **4.实时**



## OS运行环境

### １.CPU运行模式

**1.核心态：**

可以执行除访管指令外**所有的指令**

包括**特权指令**：中断/异常服务程序，进程调度，I/O指令，即涉及到一切跟**资源相关**的

**2.用户态：**

只能执行非特权指令和访管指令(Trap)

**模式的转换：**

用户态—>核心态：通过**硬件**实现



### ２.中断和异常的处理

中断：通常指外部硬件中断

异常：（1）故障：执行指令过程中出现的错误，例如**缺页、除数为0、溢出**等。处理中断后需要回到当前指令重新执行

​           （2）自陷：Trap指令

​            （3）终止：硬件故障，例如存储器、控制器出错等

发生异常和中断时，CPU都会由用户态转为核心态

### **3.系统调用：**

在用户程序中的提供操作系统功能（如设备、文件管理、进程、内存等）。

由于用户使用系统调用是为了用到系统中不同的功能，因此会有不同的参数，需要在转入核心态**之前就传好参数**。

接着，**再执行Trap指令**（访管），进入核心态，最后**OS内核对调用请求进行处理**

**不同OS**的系统调用显然不同



#### 常用系统调用

**1.write**

- 参数：文件描述符（int）；缓冲区首地址；传送字节数
- 返回值：传送成功的字节数
- 文件描述符:索引值，指向内核为每一个进程所维护的打开文件记录表具体文件的表目。windows中称为文件句柄

**2.read**

- 参数：文件描述符（int）；缓冲区首地址；传送字节数
- 返回值：传送成功的字节数

**3.open**

- 参数：文件名，打开方式（读、写、读写）
- 返回值：文件在打开文件表中的索引

**4.close**

- 参数：文件描述符

### ４.程序的链接和装入

见“内存管理”

### ５.程序运行时内存映像和地址空间





## OS结构

### **分层**

- 最底层：硬件—>最高层：用户接口
- 各层只能调用相邻层的功能
- 优点：1.便于调试和验证 2.以扩充和维护
- 缺点：1.定义各层功能比较困难 2.效率差：执行功能要穿越多层

### 模块化

- 按功能划分为多个独立的模块

- 模块之间的通信通过**模块接口**进行

- 性能的关键在于设计好模块的独立性：

  1.内聚性：模块**内部**各部分之间的联系紧密程度。内聚性**越高**，独立性**越好**

  2.耦合度：模块**之间**的联系。耦合越低，独立性越好

- 优点：

- 缺点：1.模块之间的接口很难满足实际需要 2.模块设计不能很好地保持一致性

### **宏内核**

所有主要功能模块放在一起，运行在核心态。性能有优势

### **微内核**

- 核心功能保留在内核，其它功能放在用户空间（服务器中）。因此需要进行频繁的用户态-核心态之间的切换
- 功能：1.进程（线程）管理 2.低级存储器管理  3.中断和trap处理 
- 优点：1.拓展和灵活 2.可靠性（不易崩溃）安全 3.可移植性  4.分布式计算
- 缺点：1.需要进行频繁的用户态-核心态之间的切换，系统开销偏大

**外核**



## OS引导

- 过程：

  1.读取**ROM**中的boot程序（区别于操作系统的引导程序，前者为计算机的引导程序），将IR置为BIOS的第一条指令

  2.硬件自检：检查硬件是否有故障

  3.加载带有操作系统的硬盘：BIOS开始读取CMOS中的boot sequence,并将控制权交给启动顺序排在第一位的存储设备，CPU将存储设备引导扇区的内容加载到内存

  4.加载主引导记录MBR，告诉CPU到硬盘的哪个主分区找OS

  5.扫描MBR中的硬盘分区表，找到含OS的硬盘活动分区。将控制权交给活动分区

  6.加载活动分区的第一个扇区（PBR 分区引导记录），用于寻找并激活分区根目录下**引导OS的程序**（启动管理器）

  7.加载启动管理器

  8.加载OS

## OS初始化

分配中断、IP端口、DMA资源。创建中断向量表和中断服务

**区别于硬盘初始化的过程！！**

### 虚拟机